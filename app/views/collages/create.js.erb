var player;

var tag = document.createElement('script');
tag.src = "http://www.youtube.com/player_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


$('#end-video-image').css('visibility', 'hidden');
$('#new_collage').css('visibility', 'hidden');
$('#sound-buttons').css('visibility', 'visible'); 
$('#collage').css('background-image', "url(../images/collage-page/play-background.png)");  
lowerGraves();
stopCoaster();

function onYouTubePlayerAPIReady() {
	player = new YT.Player('player', {
	      height: '138',
	      width: '273',
	      videoId:'<%= @collage.videos[0].title %>',
	      playerVars:{autoplay:1, controls:0, 'playlist': ['<%= @collage.videos[1..@collage.videos.length].collect{|v| v.title}.join("', '") %>']},
	      events: {
	      'onReady': onPlayerReady,
	      'onStateChange': onPlayerStateChange,
	      'onError': onPlayerError
	      }
    });
}
  
function onPlayerReady(event) {
	 if (player) {
	 	player.mute();
	    event.target.playVideo();
	  }
}
  
function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.ENDED) {
    	$('#player').css('visibility', 'hidden');  
    	$('#end-video-image').css('visibility', 'visible');   
    }
}

function onPlayerError(event) {
    player.nextVideo();
}